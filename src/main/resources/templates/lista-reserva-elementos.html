<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Reservas de Elementos | BienestarMind</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        body {
            background-color: #e9f7ef;
        }

        .navbar-custom {
            background-color: #1F9C18;
        }

        .card-custom {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .card-custom:hover {
            transform: translateY(-5px);
        }

        .table-container {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark navbar-custom shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" th:href="@{/app/dashboard}">
                BienestarMind 
            </a>
            <form th:action="@{/logout}" method="post" class="d-flex">
                <button class="btn btn-outline-light btn-sm rounded-pill px-3" type="submit">
                    Cerrar Sesi贸n
                </button>
            </form>
        </div>
    </nav>

    <div class="container mt-5">

        <div th:if="${successMessage}" class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999;">
            <div class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive"
                aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body" th:text="${successMessage}">Operaci贸n realizada.</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Cerrar"></button>
                </div>
            </div>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
            <span th:text="${errorMessage}">Mensaje de error</span>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="fw-bold text-success">Reservas de Elementos</h1>
            <a th:href="@{/app/reservaelementos/nueva}" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Nueva Reserva
            </a>
        </div>

        <form method="get" action="/app/reservaelementos" class="mb-4">
            <div class="row g-3 align-items-stretch">

                <div class="col-md-12">
                    <div class="card border-secondary h-100">
                        <div class="card-header bg-secondary text-white">
                             Filtros
                        </div>
                        <div class="card-body">
                            <div class="d-flex flex-row justify-content-between">
                                <!-- Filtro Descripci贸n -->
                                <div class="col-6">
                                    <label for="descripcion" class="form-label">Descripci贸n</label>
                                    <div class="input-group">
                                        <input type="text" name="descripcion" id="descripcion" class="form-control"
                                            th:value="${descripcion}">
                                        <button type="button" class="btn btn-outline-secondary" title="Limpiar"
                                            onclick="document.getElementById('descripcion').value = ''">
                                            Ч
                                        </button>
                                    </div>
                                </div>

                                <!-- Filtro Desde -->
                                <div class="col-3">
                                    <label for="desde" class="form-label">Desde</label>
                                    <div class="input-group">
                                        <input type="date" name="desde" id="desde" class="form-control"
                                            th:value="${desde}">
                                        <button type="button" class="btn btn-outline-secondary" title="Limpiar"
                                            onclick="document.getElementById('desde').value = ''">
                                            Ч
                                        </button>
                                    </div>
                                </div>

                                <!-- Filtro Hasta -->
                                <div class="col-3">
                                    <label for="hasta" class="form-label">Hasta</label>
                                    <div class="input-group">
                                        <input type="date" name="hasta" id="hasta" class="form-control"
                                            th:value="${hasta}">
                                        <button type="button" class="btn btn-outline-secondary" title="Limpiar"
                                            onclick="document.getElementById('hasta').value = ''">
                                            Ч
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Bot贸n abajo a la izquierda -->
                            <div class="mt-3 text-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-search me-2"></i>  Filtrar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>


        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr class="table-light">
                            <th>ID</th>
                            <th>Fecha</th>
                            <th>Descripci贸n</th>
                            <th>Ficha</th>
                            <th>Reservado Por</th>
                            <th>Elemento</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="reserva : ${listaReservas}">
                            <td th:text="${reserva.idReservaElemento}">1</td>
                            <td th:text="${#temporals.format(reserva.fechaReserva, 'dd/MM/yyyy')}"></td>
                            <td th:text="${reserva.descripcionReserva}"></td>

                            <td th:text="${reserva.ficha != null} ? ${reserva.ficha.idFicha} : '---'"></td>
                            <td
                                th:text="${reserva.usuario != null} ? ${reserva.usuario.nombres} + ' ' + ${reserva.usuario.apellidos} : '---'">
                            </td>
                            <td th:text="${reserva.elemento != null} ? ${reserva.elemento.nombreElemento} : '---'"></td>

                            <td class="text-end">
                                <a th:href="@{'/app/reservaelementos/editar/' + ${reserva.idReservaElemento}}"
                                    class="btn btn-sm btn-warning me-1 text-white">Editar</a>
                                <a th:href="@{'/app/reservaelementos/eliminar/' + ${reserva.idReservaElemento}}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('驴Est谩s seguro de eliminar esta reserva?');">Eliminar</a>
                            </td>
                        </tr>

                        <tr th:if="${#lists.isEmpty(listaReservas)}">
                            <td colspan="7" class="text-center py-4 text-muted">No hay reservas de elementos
                                registradas.</td>
                        </tr>
                    </tbody>
                </table>
                <a th:href="@{/app/reservaelementos/reporte-reserva-elementos(descripcion=${descripcion}, desde=${desde}, hasta=${hasta})}"
                    class="btn btn-primary mt-3">
                    Descargar PDF</a>

            </div>
        </div>

        <div class="mt-4 text-center">
            <a th:href="@{/app/dashboard}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver al Dashboard Principal
            </a>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function () {
            var toastEl = document.querySelector('.toast');
            if (toastEl) {
                var toast = new bootstrap.Toast(toastEl);
                toast.show();
            }
        });
        /*]]>*/
    </script>
</body>

</html>